Q: To solve the lab, log in as the administrator and delete carlos.

A: 
1. Go to login and click forgot password.
2. Enter administrator as username 
3. Monitor the response in burpsuite in target tab
4. Notice the POST /forgot-password and the related js request /static/js/forgotPassword.js
5. Send the Post request to to intruder to check which http method is available.
6. After add payload and start attack, only POST Method is supported. so we need to find another way
7. Send to intruder and send the request.
8. Observe the response and try to manipulate the parameter.
9. add wrong username (administrator > administators)
10. Notice the response. the response shows "/administrator" this is suspicious as it include path. from this we can decide that a valid endpoint is reached.
13. add truncating #23 into the parameter (username%23)
14. notice the response is "Invalid route. Please refer to the API definition". this response means the 
- the api is parsed
- the server received the request.
- but it does not find a valid route which means does not reach the endpoint
15. So we need to find the endpoint
16. try to put ./ as username
17. notice that the response is okay. this means it is vulnerable to (internal API path manipulation)
18. so we need to find the api directory by using username= ../%23. this will make it 1 one directory. move the directory up until we see the response is not found. which means that we are outside of API root.
19. notice only up until ../../../%23 is within the API root.

why ../../../ not ...../ ( to go up one dir we use ../ if ..../ is use then we will be send to a directory literally named "...." if exit

20. At this level, add some common API definition filenames to the URL path. For example, submit the following:
username=../../../../openapi.json%23

21. Notice the response. /api/internal/v1/users/{username}/field/{field}" this is the api endpoint. 

21. we will use this and put email as field.so username become (username=administrator/field/email%23)
22. in js file /static/js/forgotPassword.js . notice the field which we can use to request "window.location.href = `/forgot-password?passwordResetToken=${resetToken}`;

22. put passwordResetToken as field. Notice the response.tells you the endpoint youâ€™re supposed to be using is a restricted API

23. instead put a whole ./../v1/users/administrator/field/passwordResetToken%23 as username is instead of administrator/field/passwordResetToken%23

why is this because we can assume there is no blocking when we call api root level endpoint.

24. use token from the response and put in web. change the password of administrator and delete carlos


